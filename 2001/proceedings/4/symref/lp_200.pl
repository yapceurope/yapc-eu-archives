## LPE sort04_h____!O-s10,18,15,19,34,33,22,20!	Leerlingenlijst + selectie
## Instelling printer: minimaal 78 breed
##                     pagina = 64, cmd = lp -s -op12 -onolm

# %W%	[%E%]

use Text::Format;

format TOP =
Gemeente @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<             Blad: @>>>>>>
         $s_gem,                                                        $%
@<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Datum: @<<<<<<<<<<, @<<<<
$title_200,						     $D_sys_s,   $T_sys
===============================================================================
.

$catsep = 0;
$recsep = 1;
$fmt_02 = 0;

$dis_xx = ($fmt =~ m/(\d\d\d).pl$/)[0] - 200;
$dis_04	= $dis_xx &  2;	# ll_go
$dis_05	= $dis_xx & 32;	# ll_overg
$dis_06	= $dis_xx &  8;	# ll_verz
$dis_07	= $dis_xx & 16;	# ll_pv
$dis_08	= $dis_xx &  4;	# ll_vok
$dis_02	= $dis_xx &  1;	# ll_aant

if (open HDR, "$ENV{SCRIPTS}/lp_200.hdr") {
    while (<HDR>) {
	print STDERR;
	my ($code, $cont, $title, $opt) = split m/:/ or next;
	$code - 200 == $dis_xx or next;
	$title_200 = $title =~ m/\S/ ? $title : $cont;
	$opt =~ m/S/	and $catsep = 1;
	$opt =~ m/s/	and $catsep = 0;
	$opt =~ m/R/	and $recsep = 1;
	$opt =~ m/r/	and $recsep = 0;
	$opt =~ m/A/	and $fmt_02 = 1;
	$opt =~ m/a/	and $fmt_02 = 0;
	last;
	} 
    close HDR;
    }
else {
    my @dis = ("Leerlingenlijst met NAW");
    $dis_02 and push @dis, "aant";
    $dis_04 and push @dis, "GO";
    $dis_08 and push @dis, "VOK";
    $dis_06 and push @dis, "verz";
    $dis_07 and push @dis, "PV";
    $dis_05 and push @dis, "overg";
    ($title_200 = join ", ", @dis) =~ s/^(.*,[^,]+), ([^,]+)$/$1 en $2/;
    }

$ftxt = Text::Format->new ({
    columns	=> 79,
    firstIndent	=>  0,
    rightAlign	=>  0,
    rightFill	=>  0});

###############################################################################
###
### 01:Leerling
###
sub A01
{
    need 3;
    } # A01

push @fmt, "A01";
format A01 =
@>>>>> @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @ @<<<<<<<<<
$e180000, "$e180011, $e180025",                              $e180050, $e180041
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @>>>>>>>>>>
       $e180152,                                                    $e180031
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $e180212
.

###############################################################################
###
### 04:Genoten onderwijs
###
sub A04
{
    $ehdr04 = ($e190030 eq "") ? "" : "--- Genoten onderwijs";
    $ehdr04 eq "" and return;
    $e040000 = join ", ", grep (m/\S/, $e190023, $e190073, $e190060);
    $e190041 ne "" and substr ($e190041, 0, 0) = "- ";
    $catsep and ($---, print "\n");
    need 3;
    } # A04

$dis_04 and push @fmt, "A04";
format A04 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr04
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e197030,                                        $e190031,  $e190041
~~         ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< ^<<<<<<<<<
           $e040000,                                                 $e190081
.

sub S04
{
    need 2;
    $e040000 = join ", ", grep (m/\S/, $e190023, $e190073, $e190060);
    $e190041 ne "" and substr ($e190041, 0, 0) = "- ";
    } # S04

$dis_04 and push @fmt, "S04:19";
format S04 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e197030,                                        $e190031,  $e190041
~~         ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< ^<<<<<<<<<
           $e040000,                                                 $e190081
.

###############################################################################
###
### 05:Overgang
###
sub A05
{
    $ehdr05 = ($e340020 eq "") ? "" : "--- Overgang";
    $ehdr05  eq "" and return;
    $e340031 ne "" and substr ($e340031, 0, 0) = "- ";
    $catsep and ($---, print "\n");
    need 3;
    } # A05

$dis_05 and push @fmt, "A05";
format A05 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr05
~      @<<<<<<<<< @<<<<<<<<<<< ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $e340021,  $e340031,    $e340040
~~                             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
			       $e340040
.

sub S05
{
    $dis_05 and $e052321 ne "" and substr ($e052321, 0, 0) = "- ";
    } # S05

$dis_05 and push @fmt, "S05:34";
format S05 =
~~     @<<<<<<<<< @<<<<<<<<<<< @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $e340021,  $e340031,    $e340040
.

###############################################################################
###
### 06:Verzuim
###
sub A06
{
    $ehdr06 = ($e330070 eq "") ? "" : "--- Verzuim";
    $ehdr06 eq "" and return;
    $catsep and ($---, print "\n");
    ($e330041 = $e330040) =~ s/\d\d$/:$&/;
    ($e330051 = $e330050) =~ s/\d\d$/:$&/;
    $e330031 ne "" and substr ($e330031, 0, 0) = "- ";
    $e330051 ne "" and substr ($e330051, 0, 0) = "- ";
    } # A06

$dis_06 and push @fmt, "A06";
format A06 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr06
~      @  @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<< @<<<< @<<<<<<
       $e330072,$e330071                  $e330021,  $e330031,$e330041,$e330051
~~             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
               $e330060
.

sub S06
{
    need 2;
    ($e330041 = $e330040) =~ s/\d\d$/:$&/;
    ($e330051 = $e330050) =~ s/\d\d$/:$&/;
    $e330031 ne "" and substr ($e330031, 0, 0) = "- ";
    $e330051 ne "" and substr ($e330051, 0, 0) = "- ";
    } # S06

$dis_06 and push @fmt, "S06:33";
format S06 =
~      @  @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<< @<<<< @<<<<<<
       $e330072,$e330071                  $e330021,  $e330031,$e330041,$e330051
~~             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
               $e330060
.

###############################################################################
###
### 07:Proces verbaal
###
sub A07
{
    $ehdr07 = ($e220020 eq "") ? "" : "--- Processen verbaal";
    $ehdr07 eq "" and return;
    $ftxt->config ({
	leftMargin	=> 15,
	justify		=>  1,
	extraSpace	=>  1
	});
    @e220070 = $ftxt->format ($e220070);
    $catsep and ($---, print "\n");
    need (2 + @e220070);
    } # A07

$dis_07 and push @fmt, "A07";
format A07 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr07
~      @ @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<< @<<<<<<<<<
       $e220040,$e220026,                      $e220031,  $e220051,  $e220061
@*
@e220070
.

sub S07
{
    @e220070 = $ftxt->format ($e220070);
    need (1 + @e220070);
    } # S07

$dis_07 and push @fmt, "S07:22";
format S07 =
~~     @ @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<< @<<<<<<<<<
       $e220040,$e220026,                      $e220031,  $e220051,  $e220061
@*
@e220070
.

###############################################################################
###
### 08:VOK's
###
sub A08
{
    $ehdr08 = ($e200073 eq "") ? "" : "--- VOK's";
    $ehdr08  eq "" and return;
    $e200031 ne "" and substr ($e200031, 0, 0) = "- ";
    $catsep and ($---, print "\n");
    need 3;
    } # A08

$dis_08 and push @fmt, "A08";
format A08 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr08
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e200073,                                        $e200021,  $e200031
~~             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
               $e200060
.

sub S08
{
    need 2;
    $e200031 ne "" and substr ($e200031, 0, 0) = "- ";
    } # S08

$dis_08 and push @fmt, "S08:20";
format S08 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e200073,                                        $e200021,  $e200031
~~             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
               $e200060
.

###############################################################################
###
### 02:Aantekeningen
###
sub A02
{
    $ehdr02 = ($e150020 eq "") ? "" : "--- Aantekeningen";
    $ehdr02 eq "" and return;
    $e150022 = $fmt_02 ? $e150021 : $e150020;
    $catsep and ($---, print "\n");
    need 2;
    } # A02

$dis_02 and push @fmt, "A02";
format A02 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr02
~~     ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $e150022
.

$dis_02 and $fmt_02 == 0 and push @fmt, "S02:15";
format S02 =
~~     ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $e150020
.

sub EOR
{
    $~ = $recsep ? "EOR1" : "EOR";
    write;
    $~ = "EOR";
    } # EOR

push @fmt, "EOR";
format EOR =
.

format EOR1 =
------
.

1;
