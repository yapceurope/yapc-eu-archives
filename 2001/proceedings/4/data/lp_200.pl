## LPE sort04_h____!O-s0,1,2,3,4,5,6,7,8,10,11,12,13!	Leerlingenlijst + selectie
## Instelling printer: minimaal 79 breed
##                     pagina = 64, cmd = lp -s -op12 -onolm

# @(#)lp_200.pl	3.2	[01/05/23]

use PROCURA::RPT;
use Text::Format;

format TOP =
Gemeente @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<             Blad: @>>>>>>
         $s_gem,                                                        $%
@<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Datum: @<<<<<<<<<<, @<<<<
$title_200,                                                  $D_sys_s,   $T_sys
===============================================================================
.

$recsep = 0;
$catsep = 0;
$fmt_02 = 0;

$dis_xx = defined $opt_x
    ? $opt_x =~ m/^[1-9]\d*$/
	? $opt_x + 0
	: hex ($opt_x)
    : $fmt =~ m/-...\.pl$/	# lp_xxx.pl (decimal), lp-xxx.pl (hex)
	? hex (($fmt =~ m/([\dA-F]]{3})\.pl$/)[0]) & 0xDFF
	: ($fmt =~ m/(\d{3})\.pl$/i)[0] % 800;
$dis_02	= $dis_xx & 0x0001;	# ll_aant
$dis_03	= $dis_xx & 0x0040;	# ll_vera
$dis_04	= $dis_xx & 0x0002;	# ll_go
$dis_05	= $dis_xx & 0x0020;	# ll_overg
$dis_06	= $dis_xx & 0x0008;	# ll_verz
$dis_07	= $dis_xx & 0x0010;	# ll_pv
$dis_08	= $dis_xx & 0x0004;	# ll_vok
#dis_09 = n/a			# ll_adr
$dis_10 = $dis_xx & 0x0080;	# ll_rmc
$dis_11 = $dis_xx & 0x0100;	# ll_llv
$dis_12 = $dis_xx & 0x0400;	# ll_extra
$dis_13 = $dis_xx & 0x1000;	# ll_lpa

if (open HDR, "$ENV{SCRIPTS}/lp_200.hdr") {
    while (<HDR>) {
	my ($code, $cont, $title, $opt) = split m/:/ or next;
	$code - 200 == $dis_xx or next;
	$title_200 = $title =~ m/\S/ ? $title : $cont;
	$opt =~ m/S/	and $catsep = 1;
	$opt =~ m/s/	and $catsep = 0;
	$opt =~ m/R/	and $recsep = 1;
	$opt =~ m/r/	and $recsep = 0;
	$opt =~ m/A/	and $fmt_02 = 1;
	$opt =~ m/a/	and $fmt_02 = 0;
	last;
	} 
    close HDR;
    }
unless (defined $title_200 && $title_200 =~ m/\S/) {
    my @dis = ("Leerlingenlijst met NAW");
    $dis_03 and push @dis, "vera";
    $dis_02 and push @dis, "aant";
    $dis_04 and push @dis, "GO";
    $dis_08 and push @dis, "VOK";
    $dis_06 and push @dis, "verz";
    $dis_07 and push @dis, "PV";
    $dis_05 and push @dis, "overg";
    $dis_10 and push @dis, "RMC";
    $dis_11 and push @dis, "LLV";
    $dis_12 and push @dis, "Extra";
    $dis_13 and push @dis, "LPA";
    ($title_200 = join ", ", @dis) =~ s/^(.*,[^,]+), ([^,]+)$/$1 en $2/;
    length ($title_200) > 53 and $title_200 =~ s/, /,/g;
    length ($title_200) > 53 and $title_200 =~ s/NAW,//;
    length ($title_200) > 53 and $title_200 =~ s/met/+/;
    }

$ftxt = Text::Format->new ({
    columns	=> 79,
    firstIndent	=>  0,
    rightAlign	=>  0,
    rightFill	=>  0});

###############################################################################
###
### 01:Leerling
###
sub A01
{
    $e[1]{a241} = "$e[1]{241}, $e[1]{214}";
    need 3;
    } # A01

push @fmt, "A01";
format A01 =
@>>>>> @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @ @<<<<<<<<<
$e[1]{100}, $e[1]{a241},                                 $e[1]{410}, $e[1]{311}
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @>>>>>>>>>>
       $e[1]{1100},                                                 $e[1]{121}
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $e[1]{1025}
.

###############################################################################
###
### 03:Verantwoordelijken
###
sub A03
{
    $ehdr03 = $e[3]{110} eq "" && $e[3]{240} eq "" ? "" : "--- Verantwoordelijken";
    $ehdr03 eq "" and return;
    $e[3]{200} = join " " => grep m/\S/ => initials ($e[3]{211}), $e[3]{241};
    $e[3]{500} = $bss{$e[3]{420}};
    $catsep and ($---, print "\n");
    need 2;
    } # A04

$dis_03 and push @fmt, "A03";
format A03 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr03
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @>> @<<<<<<<<< @ @<<<<<<<<<
       $e[3]{200},              $e[3]{500}, $e[3]{9211}, $e[3]{410}, $e[3]{311}
.

sub S03
{
    $e[3]{211} eq "" and $e[3]{211} = $e[3]{210};
    $e[3]{241} eq "" and $e[3]{241} = $e[3]{240};
    $e[3]{200} = join " " => grep m/\S/ => initials ($e[3]{211}), $e[3]{241};
    $e[3]{500} = $bss{$e[3]{420}};
    } # S04

$dis_03 and push @fmt, "S03";
format S03 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @>> @<<<<<<<<< @ @<<<<<<<<<
       $e[3]{200},              $e[3]{500}, $e[3]{9211}, $e[3]{410}, $e[3]{311}
.

###############################################################################
###
### 04:Genoten onderwijs
###
sub A04
{
    $ehdr04 = $e[4]{2310} eq "" ? "" : "--- Genoten onderwijs";
    $ehdr04 eq "" and return;
    $e[4]{0000} = join ", " => grep m/\S/ => $e[4]{2022}, $e[4]{2032}, $e[4]{2040};
    $e[4]{2321} ne "" and substr ($e[4]{2321}, 0, 0) = "- ";
    $catsep and ($---, print "\n");
    need 3;
    } # A04

$dis_04 and push @fmt, "A04";
format A04 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr04
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e[4]{2012},                                     $e[4]{2311},$e[4]{2321}
~~         ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< ^<<<<<<<<<
           $e[4]{0000},                                             $e[4]{2331}
.

sub S04
{
    need 2;
    $e[4]{0000} = join ", " => grep m/\S/ => $e[4]{2022}, $e[4]{2032}, $e[4]{2040};
    $e[4]{2321} ne "" and substr ($e[4]{2321}, 0, 0) = "- ";
    } # S04

$dis_04 and push @fmt, "S04";
format S04 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e[4]{2012},                                     $e[4]{2311},$e[4]{2321}
~~         ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< ^<<<<<<<<<
           $e[4]{0000},                                             $e[4]{2331}
.

###############################################################################
###
### 05:Overgang
###
sub A05
{
    $ehdr05 = $e[5]{2310} eq "" ? "" : "--- Overgang";
    $ehdr05  eq "" and return;
    $e[5]{2321} ne "" and substr ($e[5]{2321}, 0, 0) = "- ";
    $catsep and ($---, print "\n");
    need 3;
    } # A05

$dis_05 and push @fmt, "A05";
format A05 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr05
~      @<<<<<<<<< @<<<<<<<<<<< ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $e[5]{2311},$e[5]{2321},$e[5]{9110}
~~                             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                               $e[5]{9110}
.

sub S05
{
    $dis_05 && $e[5]{2321} ne "" and substr ($e[5]{2321}, 0, 0) = "- ";
    } # S05

$dis_05 and push @fmt, "S05";
format S05 =
~~     @<<<<<<<<< @<<<<<<<<<<< @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $e[5]{2311},$e[5]{2321},$e[5]{9110}
~~                             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
                               $e[5]{9110}
.

###############################################################################
###
### 06:Verzuim
###
sub A06
{
    $ehdr06 = $e[6]{2410} eq "" ? "" : "--- Verzuim";
    $ehdr06 eq "" and return;
    $e[6]{2321} ne "" and substr ($e[6]{2321}, 0, 0) = "- ";
    $e[6]{2351} ne "" and substr ($e[6]{2351}, 0, 0) = "- ";
    $catsep and ($---, print "\n");
    need 3;
    } # A06

$dis_06 and push @fmt, "A06";
format A06 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr06
~      @  @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<< @<<<< @<<<<<<
       $e[6]{2414},$e[6]{2413}, $e[6]{2311},$e[6]{2321},$e[6]{2341},$e[6]{2351}
~~             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
               $e[6]{9110}
.

sub S06
{
    need 2;
    $e[6]{2321} ne "" and substr ($e[6]{2321}, 0, 0) = "- ";
    $e[6]{2351} ne "" and substr ($e[6]{2351}, 0, 0) = "- ";
    } # S06

$dis_06 and push @fmt, "S06";
format S06 =
~      @  @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<< @<<<< @<<<<<<
       $e[6]{2414},$e[6]{2413}, $e[6]{2311},$e[6]{2321},$e[6]{2341},$e[6]{2351}
~~             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
               $e[6]{9110}
.

###############################################################################
###
### 07:Proces verbaal
###
sub A07
{
    $ehdr07 = $e[7]{2520} eq "" ? "" : "--- Processen verbaal";
    $ehdr07 eq "" and return;
    $ftxt->config ({
	leftMargin	=> 15,
	justify		=>  1,
	extraSpace	=>  1
	});
    @e072561 = $ftxt->format ($e[7]{2560});
    $catsep and ($---, print "\n");
    need (2 + @e072561);
    } # A07

$dis_07 and push @fmt, "A07";
format A07 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr07
~      @ @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<< @<<<<<<<<<
       $e[7]{2530},$e[7]{2513},           $e[7]{2521}, $e[7]{2541}, $e[7]{2551}
@*
@e072561
.

sub S07
{
    @e072561 = $ftxt->format ($e[7]{2560});
    need (1 + @e072561);
    } # S07

$dis_07 and push @fmt, "S07";
format S07 =
~~     @ @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<< @<<<<<<<<<
       $e[7]{2530},$e[7]{2513},           $e[7]{2521}, $e[7]{2541}, $e[7]{2551}
@*
$e[7]{2561}
.

###############################################################################
###
### 08:VOK's
###
sub A08
{
    $ehdr08 = $e[8]{2612} eq "" ? "" : "--- VOK's";
    $ehdr08  eq "" and return;
    $e[8]{2321} ne "" and substr ($e[8]{2321}, 0, 0) = "- ";
    $catsep and ($---, print "\n");
    need 3;
    } # A08

$dis_08 and push @fmt, "A08";
format A08 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr08
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e[8]{2612},                                     $e[8]{2311},$e[8]{2321}
~~             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
               $e[8]{9110}
.

sub S08
{
    need 2;
    $e[8]{2321} ne "" and substr ($e[8]{2321}, 0, 0) = "- ";
    } # S08

$dis_08 and push @fmt, "S08";
format S08 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e[8]{2612},                                     $e[8]{2311},$e[8]{2321}
~~             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
               $e[8]{9110}
.

###############################################################################
###
### 10: RMC's
###
sub A10
{
    $ehdr10 = $e[10]{2310} eq "" ? "" : "--- RMC's";
    $ehdr10  eq "" and return;
    $e[10]{2321} ne "" and substr ($e[10]{2321}, 0, 0) = "- ";
    $e[10]{2900} = join ", " => grep m/\S/ => $e[10]{2912}, $e[10]{2022}, $e[10]{2040};
    $catsep and ($---, print "\n");
    need 3;
    } # A10

$dis_10 and push @fmt, "A10";
format A10 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr10
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e[10]{2900},                                  $e[10]{2311},$e[10]{2321}
~~             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
               $e[10]{9110}
.

sub S10
{
    need 2;
    $e[10]{2321} ne "" and substr ($e[10]{2321}, 0, 0) = "- ";
    $e[10]{2900} = join ", " => grep m/\S/ => $e[10]{2912}, $e[10]{2022}, $e[10]{2040};
    } # S10

$dis_10 and push @fmt, "S10";
format S10 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e[10]{2900},                                 $e[10]{2311}, $e[10]{2321}
~~             ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
               $e[10]{9110}
.

###############################################################################
###
### 13: LPA aantekeningen
###
sub A13
{
    $ehdr13 = $e[13]{2310} eq "" ? "" : "--- LPA aantekeningen";
    $ehdr13  eq "" and return;
    $e[13]{2321} ne "" and substr ($e[13]{2321}, 0, 0) = "- ";
    $e[13]{4021} ne "" and substr ($e[13]{4021}, 0, 0) = "=> ";
    $e139112 = join "\n", map { "               $_" } @{$e[13]{9111}};
    $catsep and ($---, print "\n");
    need 4;
    } # A13

$dis_13 and push @fmt, "A13";
format A13 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr13
~      @<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e[13]{3012},           $e[13]{4011},          $e[13]{2311},$e[13]{2321}
~                           @<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<<
                            $e[13]{4021},             $e[13]{2381}
@*~
$e139112
.

sub S13
{
    need 3;
    $e[13]{2321} ne "" and substr ($e[13]{2321}, 0, 0) = "- ";
    $e[13]{4021} ne "" and substr ($e[13]{4021}, 0, 0) = "=> ";
    if (exists $e[13]{9110}) {
	$e[13]{9111} = [ @{$e[13]{9110}} ] and
	$e[13]{9110} = $e[13]{9110}[0];
	}
    else {
	$e[13]{9111} = [];
	$e[13]{9110} = "";
	}
    $e139112 = join "\n", map { "               $_" } @{$e[13]{9111}};
    } # S13

$dis_13 and push @fmt, "S13";
format S13 =
~      @<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<< @<<<<<<<<<<<
       $e[13]{3012},           $e[13]{4011},          $e[13]{2311},$e[13]{2321}
~                           @<<<<<<<<<<<<<<<<<<<<<<<<<< @<<<<<<<<<
                            $e[13]{4021},             $e[13]{2381}
@*~
$e139112
.

###############################################################################
###
### 02:Aantekeningen
###
sub A02
{
    $ehdr02 = $e[2]{9110} eq "" ? "" : "--- Aantekeningen";
    $ehdr02 eq "" and return;
    $e[2]{9112} = $fmt_02 ? $e[2]{9111} : $e[2]{9110};
    $catsep and ($---, print "\n");
    need 2;
    } # A02

$dis_02 and push @fmt, "A02";
format A02 =
~      @<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $ehdr02
~~     ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $e[2]{9112}
.

$dis_02 and $fmt_02 == 0 and push @fmt, "S02";
format S02 =
~~     ^<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
       $e[2]{9110}
.

sub EOR
{
    $~ = $recsep ? "EOR1" : "EOR";
    write;
    $~ = "EOR";
    } # EOR

push @fmt, "EOR";
format EOR =
.

format EOR1 =
------
.

1;
